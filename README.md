# 硬件课程设计任务-频率捕捉和函数发生器FPGA
**基于Basys2 IP核的频率捕捉和函数发生器设计**
本项目为华中科技大学电信学院大三下学期硬件课设闵玉堂老师的硬件课设选题：FPGA信号发生器与频率计，原题目主要是利用basys2开发板中IP核实现外部信号频率捕捉和与其相关联的函数发生器，但实际本团队使用zynq构建。已完成的系统能够捕捉外部输入信号（正弦波、方波、锯齿波、三角波，脉冲波）的频率，并以此频率为基础产生同频率的正弦波、三角波、锯齿波和方波，并能够实现调幅，调频和直流偏置调节。
## 基本功能
可以产生信号，其频率、幅度、直流偏置都可以在一定氛围内任意调节；可以捕获外部接入信号的频率
由Basys2开发板捕捉外部输入信号（正弦波、方波、三角波、锯齿波、脉冲）的频率；
由Basys2开发板内部产生方波并测量其频率；
在已测得的外部输入信号或内部信号频率基础上，在Basys2开发板上产生1-10倍频的信号（正弦波、方波、三角波、锯齿波）；
输出信号的类型、参数可通过Basys2开发板上按键开关手动设置，由数码管显示输出频率；
实现输出波形的幅值，直流偏置可调。

## 扩展要求
   通过安卓手机控制设备，主要任务包括
1. 控制信号的发生
2. 显示信息。包括波形图像，参数等等，信号分析（频谱等等）
3. 控制产生任意波形的信号，例如在手机上可以绘制一个信号，然后信号发生器产生对应的信号。


## 考核指标
1.  外部信号（正弦波，方波，锯齿波，三角波，脉冲）的频率测试范围1-9990Hz，误差范围：1-5000Hz外部信号频率测试无波动，5000-9990Hz部份信号频率测试波动范围1-2Hz。内部方波信号频率测试500Hz;
2. 外部输入信号，输出信号，内部方波频率可在Basys2开发板上的数码管显示
   * 由于外部输入信号可测频率范围为1-9990Hz，小于1Hz，显示0；超过9999Hz,显示9999Hz;
   * 由于输出频率范围0-5000Hz,小于1Hz，数码管显示0，超过5000Hz显示5000Hz;
3. 由开发板上的按键选择输出频率，在输出频率范围（0-5000Hz）内输出各模拟信号（正弦波，方波，锯齿波，三角波)，在示波器上可观察到精准的各个波形；
4. 在示波器上可观察到外部输出波形的频率与开发板上显示外部输出信号频率一致，输出信号的频率范围为1-5000Hz（超过5000Hz输出5000Hz)，波动范围为0-25Hz；
5. 通过在外部电路可调节输出信号幅值，可调范围（方波，锯齿波，三角波):10mV-10V,(正弦波）：10mV-7V;
6. 通过外部电路可调节输出信号的直流偏置，可调节的范围为0-1.8V；


## 考核方式
本项目以团队形式参与完成，团队组成应注意选择志趣相投、各有所长的同学组合而成。个人成绩根据贡献在团队成绩基础上乘以一定的权值，一般小于1，特别突出的组长可以大于1。具体分数构成：
| 团队分数构成 | %   | 备注 |
|--------------|-----|------|
| 基本功能     | 40  |      |
| 扩展功能     | 20  | 在量 |
| 项目报告     | 20  | 需求报告，设计报告，测试报告 |
| 创意功能或其他 | 20  | 在意 |
| 团队满分     | 100 |      |
| 与PSOC结合   | 10  | 能够使用PSOC结合使用，完成一定的功能，或者能够全面的使用其功能 |

# 系统概述

## 系统组成
* ZYNQ7020+ADC+DAC*2+外围调幅调偏电路
* 外围调幅调偏电路：继电器分档调节

## 硬件设计
[邀请 - 嘉立创EDA - 一个用心为中国人定制的电路板开发平台](https://u.lceda.cn/join?type=project&key=5fa20fb35af104b861f3b8c55dfc04e8&inviter=7073b205e26448d2b63ad134a79b56df)

## 整体框架
![image](https://github.com/user-attachments/assets/230a7c4b-de07-409d-9f21-2c26adbd5304)
![image](https://github.com/user-attachments/assets/716e478b-e3a9-426e-9740-02fe5015bd3d)


## 任务安排

**6月5日 08:00**

- [x] 硬件电路
    - [x] 双通道反向加法器，带宽300M，输出幅度10V以上，可分档调节幅度
    - [x] 焊接

- [x] ZYNQ-PL端
    - [x] 信号生成（双通道）
        - [x] 正弦波：SIN_DDS RTL module，采用四级流水线结构优化时序与电路面积，采用ROM存放1/4周期波形查表显示，AXI Lite总线控制。
        - [x] 锯齿波：RTL module, AXI Lite 总线控制 
            - 可以参考 `triangle_dds` 的内容，把 `freq_word` 改成 `incr_word` 和 `decr_word`
        - [x] 方波：RTL module, AXI Lite 总线控制 
            - 接口为 `cnt_word`, `cmp_word`, `pha_word` 及 `amp_word`
            - `cnt_word` 控制频率, `cmp_word` 控制占空比, `amp_word` 控制幅度

- [x] 信号采集与分析（单通道）
    - [x] 控制LTC2220 ADC采样输入信号 
    - [x] 时钟计数法测量外部信号频率 
    - [x] ADC信号频域分析 
        - ADC数据流->LTC2220_Sample(User IP)->FFT IP->DMA->DDR3

- [x] ZYNQ-PS端
    - [x] SPI-DAC通信调节偏置 
    - [x] 串口屏控制逻辑
        - [x] PS端接收中断处理
        - [x] 对串口屏发送的数据进行解包、控制PL端的模块
    - [x] 串口传输频谱数据 
- [x] 串口屏（参考[串口屏说明](http://wiki.tjc1688.com/)）
    - [x] 设计串口屏UI
    - [x] 设计串口屏各按键按键时发送的数据
    - [x] 接受PS端传输的频谱数据并绘图显示
